Motion JPEG
===========

このフォルダーに収録されているデバイスコネクター用設定ファイル（logger_001.conf）は、ウェブカメラからの画像をintdashに送信するための設定のサンプルです。

Agentにはデフォルトのデバイスコネクターintdash-edge-loggerが付属しています。
intdash-edge-loggerとこの設定ファイルを使用することにより、UVC（USB Video Class）形式のウェブカメラから出力されるMotion JPEGをintdashに送信できます。

## 前提条件

### 実行環境
- intdash Edge Agent1.15.0 以降

## 使用手順

1. Agent用の設定ファイル（manager.conf）に、接続先サーバーとエッジ（このAgentが送信側のエッジになります）の情報を書き込みます。

    以下の情報を設定します。設定が必要な個所がそれぞれ2箇所あることに注意してください。
    
    - `"host"` : 接続先サーバー（例：dummy.intdash.jp）。2箇所に同じ値を設定します。
    - `"my_id"` : エッジUUID（例：01234567-0123-0123-0123-0123456789AB）。2箇所に同じ値を設定します。
    - `"my_token"` : エッジトークン（例：0123456789ABCDEFGHIJ0123456789abcdefghij01234567）。2箇所に同じ値を設定します。

2. Agent用の設定ファイル（manager.conf）で、デバイスコネクター用設定ファイルのパスを指定します。設定する箇所は以下のとおりです。

    - `"conf"`: このサンプルフォルダーにあるlogger_001.confのフルパス

3. ウェブカメラのデバイスパスを確認します。

    まず、対象のウェブカメラを接続していない状態で以下のコマンドを実行してください。
    
    ```
    $ ls /dev/v4l/by-id
    ```

    次に、対象のウェブカメラを接続した状態で以下のコマンドを実行してください。

    ```
    $ ls /dev/v4l/by-id
    ```

    ここで新たに見つかったデバイスパスが、対象のカメラのデバイスパスです。

4. デバイスコネクター用設定ファイル logger_001.conf に、ウェブカメラのデバイスパスを記載します。変更箇所は以下のとおりです。
    
    - `"path"` : 手順3. で見つかったデバイスパスのフルパス（例：/dev/v4l/by-id/usb-webcam）

5. intdash Edge Agentを実行します。

    以下のコマンドで、intdash Edge Agentを起動します。その際、設定ファイルとして、上の手順で変更したmanager.confを指定します。
    <サンプルフォルダーのフルパス> には適切なパスを設定してください。

    ```
    $ sudo LD_LIBRARY_PATH=/opt/vm2m/lib /opt/vm2m/sbin/intdash-edge-manager -C <サンプルフォルダーのフルパス>/manager.conf
    ```


## 実行結果

intdashサーバーに以下のデータポイントが送信されます。
約66.666[msec]ごと（15fpsのため）に1つのデータポイントが送信されます。

| フィールド            | 値                   |
|:-------------------|:------------------------------|
| 送信元エッジ         | `"my_id"`に設定したエッジ       |
| チャンネル           | 1                            |
| データタイプ         | JPEG (0x09)                  |
| データ              | カメラが取得したJPEG            |


### その他

標準出力にはさまざまなログメッセージが出力されます。通信に関する主なログメッセージは以下のとおりです。

| ログメッセージ                                                 | 意味                                                                              |
|:----------------------------------------------------|:----------------------------------------------------------------------------------|
| `receive 15 videodata -> 15 -> send 15 videopacket` | intdash-edge-loggerが処理した秒間データ数です。 `receive 0`の場合、データが取得できていません。 |
| `REALTIME 15 units and 0 basetimes with ID:10`      | intdash Edge Agentがサーバーにリアルタイムで送信できた秒間データポイント数です（この例の場合、基準時刻以外のデータポイントが15個、基準時刻を格納したデータポイントが0個）。|
