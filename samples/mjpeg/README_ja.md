Motion JPEG
===========

このサンプルでは、プリセットのデバイスコネクター（intdash-edge-logger）を使用して、UVCデバイスからMotionJPEGを取得し、intdashに送信する方法を紹介します。

intdash-edge-loggerを使用すると、設定ファイルを変更するだけで、UVC（USB Video Class）形式のウェブカメラが出力するMotion JPEGを、intdashに送信できます。


## 前提条件

### 実行環境
- intdash Edge 1.15.0 以降

## 手順

1. 設定ファイルに接続先の情報を書き込む

    このフォルダの manager.conf に、接続先情報を記載します。変更箇所は下記です。２箇所ずつある事に注意してください。
    
    - `"host"` : 接続先サーバー、２箇所（例：dummy.intdash.jp）
    - `"my_id"` : 接続エッジID、２箇所（例：01234567-0123-0123-0123-0123456789AB）
    - `"my_token"` : 接続エッジトークン、２箇所（例：0123456789ABCDEFGHIJ0123456789abcdefghij01234567）

2. 設定ファイルのパスを書き込む

    このフォルダの manager.conf に、起動するデバイスコネクターが使用する設定ファイルのパスを記載します。変更箇所は下記です。

    - `"conf"`: このサンプルフォルダにあるlogger_001.confのフルパス

3. ウェブカメラのデバイスパスを確認する

    まず、対象のウェブカメラを接続していない状態で下記コマンドを実行してください。
    
    ```
    $ ls /dev/v4l/by-id
    ```

    次に、対象のウェブカメラを接続した状態で下記コマンドを実行してください。

    ```
    $ ls /dev/v4l/by-id
    ```

    ここで新たに見つかったデバイスパスが対象のカメラのデバイスパスです。

4. 設定ファイルにウェブカメラのデバイスパスを書き込む

    このフォルダの logger_001.conf に、ウェブカメラのデバイスパスの情報を記載します。変更箇所は下記です。
    
    - `"path"` : 手順3. で見つかったデバイスパスのフルパス（例：/dev/v4l/by-id/usb-webcam）

5. 実行

    intdash Edgeの実行します。下記コマンドの <サンプルフォルダのフルパス> に適切なパスを設定し実行してください。

    ```
    $ sudo LD_LIBRARY_PATH=/opt/vm2m/lib /opt/vm2m/sbin/intdash-edge-manager -C <サンプルフォルダのフルパス>/manager.conf
    ```


## 実行結果

intdashサーバーに下記データが送信されます。

| 送信データの情報    　| 設定されている値                |
|:-------------------|:------------------------------|
| 送信元エッジ         | `"my_id"`に設定したエッジ       |
| チャンネル           | 1                            |
| データタイプ         | JPEG (0x09)                  |
| データ              | カメラが取得したJPEG            |
| 送信タイミング       | 約66.666[msec]毎（15fpsのため） |


### その他

標準出力には様々なログが出力されます。通信に関する主要なログは下記になります。

| ログ                                                 | 意味                                                                              |
|:----------------------------------------------------|:----------------------------------------------------------------------------------|
| `receive 15 videodata -> 15 -> send 15 videopacket` | intdash-edge-loggerが処理した秒間データ数です。\n`receive 0`の場合データが取得出来ていません |
| `REALTIME 15 units and 0 basetimes with ID:10`      | intdash Edgeがサーバーにリアルタイムで送信できた秒間データ数です。                          |
