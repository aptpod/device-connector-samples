Hello intdash! (Bash)
=====================

このデバイスコネクターは、intdashサーバーにデータを送信する（アップストリームを行う）ためのサンプルです。

このデバイスコネクターはBashで作成されており、一定の文字列を一定の間隔でAgentに渡します。

本来は、センサーなどのデバイスから取得したデータをAgentに渡すのがデバイスコネクターの役割ですが、ここではその代わりにプログラム内で文字列データ（"Hello intdash!"）を生成し、Agentに渡します。
Agentは、受け取ったデータをintdashサーバーに送信します。

## 前提条件

### 実行環境
- intdash Edge Agent 1.15.0 以降
- bash

## 使用手順

1. Agent用の設定ファイル（manager.conf）に、接続先サーバーとエッジ（このAgentが送信側のエッジになります）の情報を書き込みます。

    以下の情報を設定します。設定が必要な個所がそれぞれ2箇所あることに注意してください。
    
    - `"host"` : 接続先サーバー（例：dummy.intdash.jp）。2箇所に同じ値を設定します。
    - `"my_id"` : エッジUUID（例：01234567-0123-0123-0123-0123456789AB）。2箇所に同じ値を設定します。
    - `"my_token"` : エッジトークン（例：0123456789ABCDEFGHIJ0123456789abcdefghij01234567）。2箇所に同じ値を設定します。

2. Agent用の設定ファイル（manager.conf）で、デバイスコネクター（hello-intdash-connector.sh）のパスを指定します。設定する箇所は以下のとおりです。

    - loggersオブジェクトの `"path"`: このサンプルフォルダーにあるhello-intdash-connector.shのフルパス

3. デバイスコネクターのファイルを実行可能にします。

    以下のコマンドで、デバイスコネクターのファイルに実行のパーミッションを設定してください。<サンプルフォルダーのフルパス> には適切なパスを指定してください。

    ```
    $ chmod 755 <サンプルフォルダーのフルパス>/hello-intdash-connector.sh
    ````

4. intdash Edge Agentを実行します。

    以下のコマンドで、intdash Edge Agentを起動します。その際、設定ファイルとして、上の手順で準備したmanager.confを指定します。
    <サンプルフォルダーのフルパス> には適切なパスを指定してください。

    ```
    $ sudo LD_LIBRARY_PATH=/opt/vm2m/lib /opt/vm2m/sbin/intdash-edge-manager -C <サンプルフォルダーのフルパス>/manager.conf
    ```

## 実行結果

intdashサーバーに以下のユニットが送信されます。
約500[msec]ごとに1つのユニットが送信され、20回送信されると終了します。

| フィールド            | 値                   |
|:-------------------|:-----------------------|
| 送信元エッジ         | `"my_id"`に設定したエッジ |
| チャンネル           | 100                    |
| データタイプ         | String (0x0A)          |
| データID            | `abc`                  |
| データ              | `Hello intdash!`       |


### その他

標準出力にはさまざまなログメッセージが出力されます。通信に関する主なログメッセージは以下のとおりです。

| ログメッセージ                                          | 意味                                                                              |
|:----------------------------------------------------|:----------------------------------------------------------------------------------|
| `REALTIME 15 units and 0 basetimes with ID:10`      | intdash Edge Agentがサーバーにリアルタイムで送信できた秒間ユニット数です（この例の場合、基準時刻以外のユニットが15個、基準時刻のユニットが0個）。|
